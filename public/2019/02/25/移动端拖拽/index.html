<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>移动端拖拽 · Jonnzer的博客</title><meta name="description" content="移动端拖拽 - Jonnzer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="search" type="application/opensearchdescription+xml" href="https://jonnzer.github.io/atom.xml" title="Jonnzer的博客"><script src="/js/Valine.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Jonnzer的博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jonnzer/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">移动端拖拽</h1><div class="tags"><a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" class="tag-title">#移动端</a></div><div class="post-info">Feb 25, 2019</div><div class="post-content"><blockquote>
<p>今天聊一下移动端的拖拽，上周一个拖动的需求，正好整理下</p>
</blockquote>
<h6 id="场景是这样的"><a href="#场景是这样的" class="headerlink" title="场景是这样的"></a>场景是这样的</h6><pre><code>需要在H5邀请函里做名字栏位的拖拽，并且要能记住它的位置以便于图片合成。</code></pre><h6 id="用到的技术"><a href="#用到的技术" class="headerlink" title="用到的技术"></a>用到的技术</h6><pre><code>它们都属于原生JS - 移动端监听拖拽的API。</code></pre><ul>
<li><code>touchStart</code> ：<strong>开始触摸</strong>屏幕时就触发</li>
<li><code>touchmove</code>：在屏幕上<strong>滑动</strong>时触发</li>
<li><code>touchend</code>:  <strong>屏幕上离开</strong>的时触发　　 </li>
</ul>
<ul>
<li>其中<em>touchStart</em>和<em>touchmove</em>会提供<em>touch</em>对象,包含</li>
</ul>
<ul>
<li>pageX：触摸目标在页面中的x坐标。</li>
<li>pageY：触摸目标在页面中的y坐标。<br>这次只用了这两个参数<h6 id="还是上点代码吧"><a href="#还是上点代码吧" class="headerlink" title="还是上点代码吧"></a>还是上点代码吧</h6><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragStart</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    isdrag = <span class="literal">true</span>;</span><br><span class="line">    tempX = <span class="built_in">parseInt</span>($(<span class="string">'.guest_name'</span>).css(<span class="string">'left'</span>) + <span class="number">0</span>);</span><br><span class="line">    tempY = <span class="built_in">parseInt</span>($(<span class="string">'.guest_name'</span>).css(<span class="string">'top'</span>) + <span class="number">0</span>);</span><br><span class="line">    x = e.touches[<span class="number">0</span>].pageX;</span><br><span class="line">    y = e.touches[<span class="number">0</span>].pageY;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragMove</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isdrag) &#123; <span class="comment">// 这里 e.touches[0].pageY中的pageY</span></span><br><span class="line">        <span class="keyword">let</span> curX = tempX + e.touches[<span class="number">0</span>].pageX - x;</span><br><span class="line">        <span class="keyword">let</span> curY = tempY + e.touches[<span class="number">0</span>].pageY - y;</span><br><span class="line">        <span class="comment">// 边界判断</span></span><br><span class="line">        <span class="comment">// curX = curX &lt; 0 ? 0 : curX;</span></span><br><span class="line">        curY = curY &lt; <span class="number">0</span> ? <span class="number">0</span> : curY;</span><br><span class="line">        curX = curX &lt; <span class="built_in">document</span>.documentElement.clientWidth - <span class="number">80</span> ? curX : <span class="built_in">document</span>.documentElement.clientWidth - <span class="number">80</span>;</span><br><span class="line">        curY = curY &lt; $(<span class="string">'.firstPageBackground'</span>).height() - <span class="number">25</span> ? curY : $(<span class="string">'.firstPageBackground'</span>).height() - <span class="number">25</span>; <span class="comment">// 这里的高度限制 $('.firstPageBackground').height() - 25 是来源于业务上，邀请函画布的高度，控制名字不能超出限制。25是名字本身的高度。都以px为单位。</span></span><br><span class="line">        $(<span class="string">'.guest_name'</span>).css(&#123;</span><br><span class="line">            <span class="string">'left'</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">'top'</span>: curY</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// 禁止浏览器默认事件</span></span><br><span class="line">        e.preventDefault();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dragEnd</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    isdrag = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id><a href="#" class="headerlink" title></a></h6>好啦，还是别卖关子了，其实原理就是，利用了两次监听移动提供的pageX和pageY 之差。将差值加到原来的绝对定位，left和top里。让dom的位置发生变化。从而达到拖拽的效果。</li>
</ul>
<h6 id="参考链接："><a href="#参考链接：" class="headerlink" title="参考链接："></a>参考链接：</h6><p><a href="https://blog.csdn.net/lee_magnum/article/details/17753807" target="_blank" rel="noopener">blog</a><br><a href="https://blog.csdn.net/qq_35800306/article/details/59502392" target="_blank" rel="noopener">blog</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2019/03/02/%E5%A4%8D%E5%88%B6%E5%86%85%E5%AE%B9/" class="prev">上一篇</a><a href="/2019/02/25/%E6%95%B0%E7%BB%84%E5%8E%BB%E9%87%8D/" class="next">下一篇</a></div><div id="vcomments"></div><!--script(src="//unpkg.com/valine/dist/Valine.min.js")--><script>new Valine({ // 里面的参数配置具体参考Valine官网
    el: '#vcomments',
    appId: `Hv8Cfy93FCgDUy3fP2Av9Ies-gzGzoHsz`,
    appKey: `4fAniISvXobBOUUx5SEE89dV`,
    placeholder: '快来评论吧(#^.^#)',
    avatar: 'wavatar'
});</script><div class="copyright"><p>© 2017 - 2020 <a href="https://jonnzer.github.io">Jonnzer</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="/js/jquery.js"></script></body></html>