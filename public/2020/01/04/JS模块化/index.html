<!DOCTYPE html><html lang="zh-Hans"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>JS模块化 · Jonnzer的博客</title><meta name="description" content="JS模块化 - Jonnzer"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/gandalfr.css"><link rel="search" type="application/opensearchdescription+xml" href="https://jonnzer.github.io/atom.xml" title="Jonnzer的博客"><script src="/js/Valine.min.js"></script><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Jonnzer的博客" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jonnzer/" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">JS模块化</h1><div class="tags"><a href="/tags/%E6%A8%A1%E5%9D%97%E5%8C%96/" class="tag-title">#模块化</a></div><div class="post-info">Jan 4, 2020</div><div class="post-content"><blockquote>
<p>模块化的简单包装</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = (<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">// 利用了自执行函数的封闭性</span></span><br><span class="line">    <span class="keyword">var</span> _count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> m1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(_count)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> m2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        alert(_count + <span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        m1: m1,</span><br><span class="line">        m2: m2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>


<h3 id="1-JS模块化发展历史"><a href="#1-JS模块化发展历史" class="headerlink" title="1 JS模块化发展历史"></a>1 JS模块化发展历史</h3><ul>
<li>CommonJS 和 AMD CMD 鼎足之势 （前） ES6 （后）<br>（知名框架 Node.js、RequireJS前置加载 和 Seajs就近加载 分别对应前三个）</li>
<li>谈谈现阶段：<ul>
<li>ES6标准发布后，module成为标准，标准使用是以<code>export</code>指令导出接口，以<code>import</code>引入模块。</li>
<li>在我们一贯的node模块中，我们依然采用的是<code>CommonJS</code>规范，使用<code>require</code>引入模块，使用<code>module.exports</code>导出接口。是<code>同步</code>加载 JS 脚本。这么做在服务端毫无问题，因为文件都存在磁盘上，然而浏览器的特性决定了 JS 脚本需要异步加载，否则就会失去响应，因此 CommonJS 规范<code>无法直接在浏览器</code>中使用。</li>
</ul>
</li>
</ul>
<h3 id="2-对于es6模块的看法（参考阮一峰老师）"><a href="#2-对于es6模块的看法（参考阮一峰老师）" class="headerlink" title="2 对于es6模块的看法（参考阮一峰老师）"></a>2 对于es6模块的看法（参考阮一峰老师）</h3><ul>
<li><p><code>es6标准</code>将成为服务器和浏览器端模块化的<code>通用解决方法</code> </p>
</li>
<li><p><code>运行时加载</code>：代码运行到这个语句的时候才会加载 </p>
</li>
<li><p><code>编译时加载</code>：打包工具编译js时，就会去分析模块之间的依赖关系，所以不能放在任何条件代码块里。层级最优先</p>
</li>
<li><p>es6模块中的this指向是undefined，不要轻易用this, CommonJs中的this指向当前模块</p>
</li>
<li><p>export的使用，如果需导出的模块前面没有export，那在export的时候就要加上{}</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">export</span> &#123;fn&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>export导出语句是动态绑定的，如果导出的值发生变化，那import进的值也会随之变化</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// exportJs</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">var</span> foo = <span class="string">'bar'</span>;</span><br><span class="line">setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; () =&gt; foo = <span class="string">'baz'</span>; &#125;,<span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">那么foo变量值将在<span class="number">500</span>ms后变成baz字符串，这点与<span class="string">`commonJS`</span>不一样，commonJs是会缓存值。</span><br></pre></td></tr></table></figure></li>
<li><p><code>import</code>命令具有提升效果，会提升到整个模块的头部并首先执行，但还是建议放在头部写比较好。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">foo();</span><br><span class="line"><span class="keyword">import</span> &#123;foo&#125; <span class="keyword">from</span> <span class="string">'module'</span>; <span class="comment">// right</span></span><br></pre></td></tr></table></figure></li>
<li><p>*号指定整体输出的一个对象</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// circle.js</span></span><br><span class="line"><span class="keyword">export</span> funciton fn1()&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js 需要引入cilcle.js</span></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> circle <span class="keyword">from</span> <span class="string">'./circle'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用：</span></span><br><span class="line">circle.fn1();</span><br><span class="line">circle.fn2();</span><br></pre></td></tr></table></figure></li>
<li><p>export 的default输出，默认输出</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// exportJs</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'foo'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// importJs</span></span><br><span class="line"><span class="keyword">import</span> customFn <span class="keyword">from</span> <span class="string">'./exportJS'</span></span><br><span class="line">customFn();</span><br></pre></td></tr></table></figure></li>
<li><p>import函数大括号的写法时机<br>export后面接着default的时候，不用大括号，没接着的时候是要大括号的。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 无 default</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">fn1</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">import</span> &#123; fn1&#125; <span class="keyword">from</span> <span class="string">'exportJs'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 有default</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">fn2</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="keyword">import</span> fn2 <span class="keyword">from</span> <span class="string">'exportJs'</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>因为静态分析没有运行时加载那么“动态化”，所以，import有个提案，目前可以在webpack使用，可以动态输入一个较为狭窄的路径，然后返回一个promise对象<br>这个情况下的import是支持<code>按需加载</code>，<code>条件加载</code>，和<code>动态的模块路径</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> main = <span class="built_in">document</span>.querySelector(<span class="string">'main'</span>)</span><br><span class="line"><span class="keyword">import</span>(<span class="string">'./someModule/$&#123;someVariable&#125;.js'</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">module</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">module</span>.loadPageInfo(main)</span><br><span class="line">    &#125;)</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        mian.textContent = err.message;                                                 </span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>script标签的defer和async属性差异，两者都是取消了js的同步属性。<br>但是defer是<code>渲染完再执行</code>，而async是<code>下载完就执行</code>。</p>
</li>
<li><p>待验证：es6模块在网页上的加载</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">"module"</span>&gt;</span><br><span class="line">    <span class="keyword">import</span> utils <span class="keyword">from</span> <span class="string">'./util.js'</span>;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>es6模块，导出的变量不可以重新赋值，但可以添加或修改属性，就是内存地址不能改，里面存的内容随你改，待验证。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// lib.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> obj = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">import</span> &#123; obj &#125; <span class="keyword">from</span> <span class="string">'lib'</span></span><br><span class="line"></span><br><span class="line">obj.prop = <span class="number">123</span>; <span class="comment">// right</span></span><br><span class="line">obj = &#123;&#125;        <span class="comment">// typeError</span></span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>import</code>命令加载<code>commonJS</code>模块，Node会自动将<code>module.exports</code>当成模块的默认输出，即等同于<code>export default</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// es.js</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'./b.js'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> bar <span class="keyword">from</span> <span class="string">'./b.js'</span></span><br><span class="line"><span class="comment">// bar = &#123;default: null&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> &#123; somethimg &#125; <span class="keyword">from</span> <span class="string">'fs'</span> <span class="comment">// error！！！</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> express <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="keyword">const</span> app = express.default() <span class="comment">// right</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>commonJs</code>的加载原理<br>commonJs每个模块都是一个脚本文件，Node内部用require命令第一次加载就会执行这个脚本，然生成一个对象，这个会缓存，即是多次require，不清缓存下，都取第一次。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    id: <span class="string">''</span>,         <span class="comment">// 模块名</span></span><br><span class="line">    exports: &#123;&#125;,    <span class="comment">// 导出模块, </span></span><br><span class="line">    loaded: <span class="literal">true</span>    <span class="comment">// 是否加载过</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>循环加载：模块之间相互引用<br>CommonJs会出现，输出已执行的部分，未执行的部分不会输出<br>es6模块则不会报错</p>
</li>
</ul>
<p>参考文章：<br><a href="https://juejin.im/post/58882a42128fe100684ad9de" target="_blank" rel="noopener">掘金</a><br>阮一峰es6 模块篇章</p>
</div></article></div></main><footer><div class="paginator"><a href="/2020/02/06/PWA/" class="prev">PREV</a><a href="/2019/12/11/webpack/" class="next">NEXT</a></div><div id="vcomments"></div><!--script(src="//unpkg.com/valine/dist/Valine.min.js")--><script>new Valine({ // 里面的参数配置具体参考Valine官网
    el: '#vcomments',
    appId: `Hv8Cfy93FCgDUy3fP2Av9Ies-gzGzoHsz`,
    appKey: `4fAniISvXobBOUUx5SEE89dV`,
    placeholder: '快来评论吧(#^.^#)',
    avatar: 'wavatar'
});</script><div class="copyright"><p>© 2017 - 2020 <a href="https://jonnzer.github.io">Jonnzer</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/MikeCoder/hexo-theme-gandalfr" target="_blank">hexo-theme-gandalfr</a>.</p></div></footer></div><script src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script src="/js/jquery.js"></script></body></html>